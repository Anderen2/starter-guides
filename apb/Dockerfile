FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHN0YXJ0ZXItd29ya3Nob3AtYXBiCmRlc2NyaXB0aW9uOiBBUEIg\
dG8gZGVwbG95IHJlcXVpcmVkIGluZnJhIGNvbXBvbmVudHMgZm9yIHRoZSBEZXZlbG9wZXIgU3Rh\
cnRlciBXb3Jrc2hvcCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFsc2UKYXN5\
bmM6IG9wdGlvbmFsCnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5jaWVzOiBb\
J2RvY2tlci5pby9vc2V2Zy93b3Jrc2hvcHBlcjpsYXRlc3QnLCdkb2NrZXIuaW8vb3BlbnNoaWZ0\
ZGVtb3MvZ29nczowLjExLjM0JywncXVheS5pby93a3VsaGFuZWsvZXRoZXJwYWQ6MS42LjUnLCdk\
b2NrZXIuaW8vc29uYXR5cGUvbmV4dXMzOjMuMTEuMCcsICdkb2NrZXIuaW8vZWNsaXBzZS9jaGUt\
c2VydmVyOjMuNy4xJywgJ2RvY2tlci5pby9yYWZmYWVsZXNwYXp6b2xpL29jcC1vcHMtdmlldzps\
YXRlc3QnXQogIGRpc3BsYXlOYW1lOiAiT3BlblNoaWZ0IERldmVsb3BlciBTdGFydGVyIFdvcmtz\
aG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246IHwtCiAgICBJbnN0YWxscyB0aGUgbGFi\
IGluc3RydWN0aW9ucyBhbmQgcmVxdWlyZWQgY29tcG9uZW50cwogICAgLSBHb2dzIHNlcnZlcgog\
ICAgLSBOZXh1cwogICAgLSBFdGhlcnBhZAogICAgLSBMYWIgR3VpZGVzCiAgICAtIEVjbGlwc2Ug\
Q2hlCiAgICAtIE9DUC1PcHNWaWV3IChpbWFnZSBieSBSYWZmYWVsZSBTcGF6em9saSkKICAgIGZv\
ciBydW5uaW5nIHRoZSBHZXR0aW5nIHN0YXJ0ZXIgZGV2ZWxvcGluZyBvbiBPcGVuU2hpZnQgV29y\
a3Nob3AgaHR0cHM6Ly9naXRodWIuY29tL29wZW5zaGlmdC1sYWJzL3N0YXJ0ZXItZ3VpZGVzCiAg\
Y29uc29sZS5vcGVuc2hpZnQuaW8vaWNvbkNsYXNzOiAicGZpY29uIHBmaWNvbi1wcm9jZXNzLWF1\
dG9tYXRpb24iCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgog\
IC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlcGxveXMgT3BlblNoaWZ0IFN0YXJ0\
ZXIgV29ya3Nob3AgSW5mcmFzdHJ1Y3R1cmUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgog\
ICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgcGFyYW1ldGVyczoKICAgIC0gbmFtZTogb3Bl\
bnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1lCiAgICAgIGRlc2NyaXB0aW9uOiBVc2Vy\
IGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwogICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBVc2VyCiAgICAtIG5hbWU6IG9wZW5zaGlm\
dF9wYXNzd29yZAogICAgICB0aXRsZTogUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IFBhc3N3\
b3JkIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgVXNlcgogICAgLSBuYW1lOiB3\
b3Jrc2hvcF90eXBlCiAgICAgIHRpdGxlOiBXb3Jrc2hvcCB0eXBlCiAgICAgIGRlc2NyaXB0aW9u\
OiBUeXBlIG9mIHdvcmtzaG9wIHRvIGRlbGl2ZXIgKEphdmEsIFB5dGhvbiwgbm9kZS5qcykKICAg\
ICAgdHlwZTogZW51bQogICAgICBlbnVtOiBbJ2phdmEnLCAncHl0aG9uJywgJ25vZGUuanMnLCAn\
cGhwJ10KICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzZWxlY3QKICAg\
ICAgZGVmYXVsdDogamF2YQogICAgICBkaXNwbGF5X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1l\
OiB1c2VyX2NvdW50CiAgICAgIHRpdGxlOiBOdW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgIGRl\
c2NyaXB0aW9uOiBOdW1iZXIgb2YgcGFydGljaXBhbnRzIGZvciB0aGUgd29ya3Nob3AuIFRoZXJl\
IHdpbGwgYmUgcHJvdmlzaW9uZWQgaW5mcmFzdHJ1Y3R1cmUvcHJvamVjdCBmb3IgZWFjaCBwYXJ0\
aWNpcGFudAogICAgICB0eXBlOiBudW1iZXIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlz\
cGxheV9ncm91cDogV29ya3Nob3AKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXJfcGFzc3dvcmQK\
ICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBU\
aGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0aWNpcGFudHMgdG8gYmUgZGlzcGxheWVkIGlu\
IHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91\
cDogV29ya3Nob3AKICAgIC0gbmFtZTogb3BlbnNoaWZ0X21hc3Rlcl91cmwKICAgICAgdGl0bGU6\
IE9wZW5TaGlmdCBNYXN0ZXIgVVJMCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgYWRkcmVzcyB0byBP\
cGVuU2hpZnQgbWFzdGVyIFVSTCB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBw\
YXJ0aWNpcGFudHMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0g\
bmFtZTogaW5mcmFzdmNzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBJbmZyYXN0cnVjdHVyZSBTZXJ2\
aWNlcyBBZG1pbiBVc2VyCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2VyIGZvciBpbmZyYXN0\
cnVjdHVyZSBzZXJ2aWNlcyAoR29ncywgQ2hlLCAuLi4pCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICBkZWZhdWx0OiAiYWRtaW51c2VyIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5\
X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogSW5mcmFzdHJ1Y3R1cmUgU2VydmljZXMK\
ICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV9wYXNzd29yZAogICAgICB0aXRsZTogSW5mcmFzdHJ1\
Y3R1cmUgU2VydmljZXMgQWRtaW4gUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHBh\
c3N3b3JkIGZvciBpbmZyYXN0cnVjdHVyZSBzZXJ2aWNlcyAoR29ncywgQ2hlLCAuLi4pCiAgICAg\
IHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW4xMjMiCiAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBJbmZyYXN0\
cnVjdHVyZSBTZXJ2aWNlcwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
